!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("FredRTETinyMCE",[],t):"object"==typeof exports?exports.FredRTETinyMCE=t():e.FredRTETinyMCE=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={exports:{},id:i,loaded:!1};return e[i].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},l=n(1),r=i(l);t.default=function(e,t){var n=t.Finder;return(0,r.default)(e,t),function(e,t,i,l,r,o){var u=new Promise(function(u,s){setTimeout(function(){var s=a({theme:"inlite",inline:!0,plugins:"modxlink image imagetools media lists",insert_toolbar:"image media quicktable modxlink",selection_toolbar:"bold italic underline | alignleft aligncenter alignright | bullist numlist | modxlink h2 h3 h4 blockquote",image_advtab:!0,imagetools_toolbar:"alignleft aligncenter alignright | rotateleft rotateright | flipv fliph | editimage imageoptions",auto_focus:!1,branding:!1,relative_urls:!1,image_dimensions:!1},t);s.target=e,s.file_picker_callback=function(t,i,a){var l=new n(function(e,n){var i=e.url,l=e.name;return"image"==a.filetype?void t(i,{alt:l}):void t(i)},"fred.fe.browse_files",n.getFinderOptionsFromElement(e,"image"===a.filetype));return l.render(),!1},s.setup=function(t){e.rte=t,t.on("change",function(e){l(t.getContent())}),t.on("undo",function(e){l(t.getContent())}),t.on("redo",function(e){l(t.getContent())}),t.on("focus",function(e){r()}),t.on("blur",function(e){o()}),i(),u()},tinymce.init(s)},1)});return u}},e.exports=t.default},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),l=i(a);t.default=function(e,t){tinymce.PluginManager.add("modxlink",(0,l.default)(e,t))},e.exports=t.default},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),l=i(a),r=n(4),o=i(r),u=n(5);t.default=function(e,t){var n=t.fredConfig,i=t.fetch,a=t.Choices;return function(e,t){var r=function(){var t=new l.default(e),r=0,s=t.getData(),c=40;switch(t.getActiveTab()){case"page":r=0;break;case"url":r=1;break;case"email":r=2;break;case"phone":r=3;break;case"file":r=4}var f=new tinymce.ui.TabPanel({type:"tabpanel",classes:"fred--modxlink-panel",activeTab:r,items:[{title:n.lng("fredrtetinymce.page"),id:"page",type:"form",items:[{id:"pagecontainer",type:"container",html:'<label for="page_url">'+n.lng("fredrtetinymce.page_title")+'</label><select id="page_url"></select>'},{type:"textbox",label:n.lng("fredrtetinymce.anchor"),id:"page_anchor",value:s.page.anchor,size:c,onkeyup:function(){s.page.anchor=this.value()}}]},{title:n.lng("fredrtetinymce.url"),id:"url",type:"form",items:[{type:"textbox",label:n.lng("fredrtetinymce.url"),value:s.url.url,size:c,onkeyup:function(){s.url.url=this.value()}}]},{title:n.lng("fredrtetinymce.email"),id:"email",type:"form",items:[{type:"textbox",label:n.lng("fredrtetinymce.to"),value:s.email.to,size:c,onkeyup:function(){s.email.to=this.value()}},{type:"textbox",label:n.lng("fredrtetinymce.subject"),value:s.email.subject,size:c,onkeyup:function(){s.email.subject=this.value()}},{type:"textbox",multiline:!0,label:n.lng("fredrtetinymce.body"),value:s.email.body,size:c,onkeyup:function(){s.email.body=this.value()}}]},{title:n.lng("fredrtetinymce.phone"),id:"phone",type:"form",items:[{type:"textbox",label:n.lng("fredrtetinymce.phone"),value:s.phone.phone,size:c,onkeyup:function(){s.phone.phone=this.value()}}]},{title:n.lng("fredrtetinymce.file"),id:"file",type:"form",items:[{type:"filepicker",label:n.lng("fredrtetinymce.file"),value:s.file.file,size:c,onchange:function(e){s.file.file=this.value()}}]}]}),d=function(e,t,n){function i(e,n){return n=n||[],tinymce.each(e,function(e){var a={text:e.text||e.title};e.menu?a.menu=i(e.menu):(a.value=e.value,t&&t(a)),n.push(a)}),n}return i(e,n||[])},p=[{type:"textbox",label:n.lng("fredrtetinymce.link_text"),name:"link_text",size:c,onkeyup:function(){s.link_text=this.value()}}];p.push({type:"textbox",name:"link_title",label:n.lng("fredrtetinymce.link_title"),size:c,onkeyup:function(){s.link_title=this.value()}}),e.settings.link_class_list?p.push({name:"classes",type:"listbox",label:n.lng("fredrtetinymce.classes"),size:c,values:d(e.settings.link_class_list,function(t){t.value&&(t.textStyle=function(){return e.formatter.getCssText({inline:"a",classes:[t.value]})})}),onchange:function(){s.classes=this.value()}}):p.push({type:"textbox",name:"classes",size:c,label:n.lng("fredrtetinymce.classes"),onkeyup:function(){s.classes=this.value()}}),p.push({type:"checkbox",name:"new_window",size:c,label:n.lng("fredrtetinymce.new_window"),onchange:function(){s.new_window=this.value()}});var g=e.selection.getNode(),h="A"==g.nodeName,m=e.windowManager.open({title:n.lng("fredrtetinymce.link_to"),classes:"fred--modxlink",data:s,buttons:[{text:n.lng("fredrtetinymce.ok"),subtype:"primary",onclick:function(){m.find("form")[0].submit()}},{text:h?n.lng("fredrtetinymce.remove_link"):n.lng("fredrtetinymce.cancel"),onclick:function(){if(h){var t=e.dom.getParent(e.selection.getStart(),"a[href]");e.selection.select(t),(0,u.unlinkSelection)(e)}m.close()}}],body:[{type:"form",layout:"grid",padding:0,columns:1,items:p},f],onsubmit:function(t){return function(n){var i=new o.default(e),a=t.items()[t.activeTabId.slice(1)]._id;i.save(a,s)}}(f)}),v=document.querySelector("#page_url"),b=null,y={},k=[],_=new a(v,{removeItemButton:!0});_.ajax(function(e){i(n.config.assetsUrl+"endpoints/ajax.php?action=get-resources&current="+s.page.page,{credentials:"same-origin",headers:{"X-Fred-Token":n.jwt}}).then(function(e){return e.json()}).then(function(t){if(k=t.data.resources,e(t.data.resources,"value","pagetitle"),t.data.current){_.setChoices([t.data.current],"value","pagetitle",!1),_.setValueByChoice(s.page.page);var i=document.getElementById("page_anchor-l");i&&(i.innerText=n.lng("fredrtetinymce.block_on",{page:t.data.current.pagetitle}))}}).catch(function(e){console.log(e)})});var x=function(e){var t=[];_.currentState.items.forEach(function(e){e.active&&t.push(e.value)});var n=[];e.forEach(function(e){t.indexOf(e.id)===-1&&n.push(e)}),_.setChoices(n,"value","pagetitle",!0)},w=function(){var e=_.input.value;e in y?x(y[e]):i(n.config.assetsUrl+"endpoints/ajax.php?action=get-resources&query="+e,{credentials:"same-origin",headers:{"X-Fred-Token":n.jwt}}).then(function(e){return e.json()}).then(function(t){y[e]=t.data.resources,x(t.data.resources)}).catch(function(e){console.log(e)})};_.passedElement.addEventListener("search",function(e){clearTimeout(b),b=setTimeout(w,200)}),_.passedElement.addEventListener("choice",function(e){_.setChoices(k,"value","pagetitle",!0),s.page.page=e.detail.choice.value,s.page.url=e.detail.choice.customProperties.url,s.link_text||(s.link_text=e.detail.choice.label,linkText.value(e.detail.choice.label));var t=document.getElementById("page_anchor-l");t&&(t.innerText=n.lng("fredrtetinymce.block_on",{page:e.detail.choice.label}))}),_.passedElement.addEventListener("removeItem",function(e){if(!_.getValue()){s.page.page="",s.page.url="";var t=document.getElementById("page_anchor-l");t&&(t.innerText=n.lng("fredrtetinymce.block_on",{page:n.pageSettings.pagetitle}))}})};return e.addButton("modxlink",{icon:"link",tooltip:n.lng("fredrtetinymce.tooltip"),onclick:r,stateSelector:"a[href]"}),e.addMenuItem("modxlink",{icon:"link",text:n.lng("fredrtetinymce.tooltip"),onclick:r,stateSelector:"a[href]"}),{getMetadata:function(){return{name:"MODX Link",url:"https://modx.com"}}}}},e.exports=t.default},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=function(){function e(t){n(this,e),this.editor=t,this.element=t.dom.getParent(t.selection.getStart(),"a[href]");var i=document.createElement("textarea");i.innerHTML=t.selection.getContent(),this.initialData={link_text:i.value,link_title:"",classes:"",new_window:!1,page:{page:"",url:"",anchor:""},url:{url:""},email:{to:"",subject:"",body:""},phone:{phone:""},file:{file:""}},this.activeTab="page",this.data=this.parseData()}return a(e,[{key:"getData",value:function(){return this.data}},{key:"getActiveTab",value:function(){return this.activeTab}},{key:"parseData",value:function(){var e=this.getElementData();return this.activeTab=e.tab,i({},this.initialData,e.data)}},{key:"getElementData",value:function(){if(!this.element)return{};this.editor.selection.select(this.element);var e={global:{link_text:"",link_title:"",classes:"",new_window:!1},page:i({},this.initialData.page||{}),url:i({},this.initialData.url||{}),email:i({},this.initialData.email||{}),phone:i({},this.initialData.phone||{}),file:i({},this.initialData.file||{})};e.global.link_title=this.element.getAttribute("title"),e.global.classes=this.element.getAttribute("class"),e.global.new_window="_blank"===this.element.getAttribute("target"),e.global.link_text=this.element.innerHTML;var t=this.element.dataset.fredLinkType,n=this.element.getAttribute("href")||"";if("page"===t&&(e.page.page=this.element.getAttribute("data-fred-link-page"),e.page.anchor=this.element.getAttribute("data-fred-link-anchor"),e.page.page||e.page.anchor))return e.page.url=n.replace("#"+e.page.anchor,""),{tab:"page",data:i({},e.global,{page:i({},e.page)})};if("email"===t&&"mailto:"===n.slice(0,7)){if(n=n.slice(7),n=n.split("?"),e.email.to=n[0],n[1]){var a=n[1].split("&");a.forEach(function(t){t=t.split("="),"subject"===t[0]&&(e.email.subject=decodeURI(t[1])),"body"===t[0]&&(e.email.body=decodeURI(t[1]))})}return{tab:"email",data:i({},e.global,{email:i({},e.email)})}}return"phone"===t&&"tel:"===n.slice(0,4)?(e.phone.phone=n.slice(4),{tab:"phone",data:i({},e.global,{phone:i({},e.phone)})}):"file"===t?(e.file.file=n,{tab:"file",data:i({},e.global,{file:i({},e.file)})}):(e.url.url=n,{tab:"url",data:i({},e.global,{url:i({},e.url)})})}}]),e}();t.default=l,e.exports=t.default},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=function(){function e(t){n(this,e),this.editor=t,this.element=t.dom.getParent(t.selection.getStart(),"a[href]")}return a(e,[{key:"insertLink",value:function(e,t){this.editor.insertContent(this.editor.dom.createHTML("a",t,e))}},{key:"editLink",value:function(e,t){if(!this.element)return this.insertLink(e,t);this.editor.focus(),this.editor.dom.removeAllAttribs(this.element);for(var n in t)t.hasOwnProperty(n)&&this.editor.dom.setAttrib(this.element,n,t[n]);this.element.innerHTML=e,this.editor.selection.select(this.element)}},{key:"handleLink",value:function(e,t){return this.element?this.editLink(e,t):this.insertLink(e,t)}},{key:"savePage",value:function(t){if(t.page.page||t.page.anchor){var n=i({},e.getGeneralAttributes(t,"page"),{"data-fred-link-page":t.page.page});return t.page.anchor?(n["data-fred-link-anchor"]=t.page.anchor,n.href=t.page.url+"#"+t.page.anchor):n.href=t.page.url,this.handleLink(t.link_text,n)}}},{key:"saveUrl",value:function(t){if(t.url.url)return this.handleLink(t.link_text,i({},e.getGeneralAttributes(t,"url"),{href:t.url.url}))}},{key:"saveEmail",value:function(t){if(t.email.to){var n="mailto:"+t.email.to,a=[];return t.email.subject&&a.push("subject="+encodeURI(t.email.subject)),t.email.body&&a.push("body="+encodeURI(t.email.body)),a.length>0&&(n+="?"+a.join("&")),this.handleLink(t.link_text,i({},e.getGeneralAttributes(t,"email"),{href:n}))}}},{key:"savePhone",value:function(t){if(t.phone.phone)return this.handleLink(t.link_text,i({},e.getGeneralAttributes(t,"phone"),{href:"tel:"+t.phone.phone}))}},{key:"saveFile",value:function(t){if(t.file.file)return this.handleLink(t.link_text,i({},e.getGeneralAttributes(t,"file"),{href:t.file.file}))}},{key:"save",value:function(e,t){switch(e){case"page":this.savePage(t);break;case"url":this.saveUrl(t);break;case"email":this.saveEmail(t);break;case"phone":this.savePhone(t);break;case"file":this.saveFile(t)}this.editor.selection.collapse(!1)}}],[{key:"getGeneralAttributes",value:function(e,t){var n={"data-fred-link-type":t};return e.link_title&&(n.title=e.link_title),e.new_window&&(n.target="_blank"),e.classes&&(n.class=e.classes),n}}]),e}();t.default=l,e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=tinymce.util.Tools,i=tinymce.dom.TreeWalker,a=tinymce.dom.RangeUtils,l=function(e,t,n){var a=void 0,l=void 0,r=[];for(a=new i(t,e),l=t;l&&(1===l.nodeType&&r.push(l),l!==n);l=a.next());return r},r=function(e,t){n.each(t,function(t){e.dom.remove(t,!0)}),e.selection.collapse()},o=function(e){return"A"===e.nodeName&&e.hasAttribute("href")},u=function(e,t){var n=e.getParent(t,o);return n?n:t},s=function(e){var t=void 0,i=void 0,r=void 0,s=void 0,c=void 0,f=void 0,d=void 0;return c=e.selection,f=e.dom,d=c.getRng(),t=u(f,a.getNode(d.startContainer,d.startOffset)),i=a.getNode(d.endContainer,d.endOffset),r=e.getBody(),s=n.grep(l(r,t,i),o)},c=t.unlinkSelection=function(e){r(e,s(e))};t.default=c}])});